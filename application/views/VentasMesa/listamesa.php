<style type="text/css">
.texto_div{

    
    margin-bottom: 15px;
}
  h1{
    text-align: center;
    text-transform: uppercase;
  }
  .logo{
    display: none !important;
  }

  .seccion {
    width: 100%;
    margin-left: 0%;
  }

  .gmesas {
    margin-top: 40px;
    margin-bottom: 40px;
  }

  .gmesas ul li,  .gmesas li img {
    -webkit-transition: all 1s cubic-bezier(.42,.2,.2,.64);
    -moz-transition: all 1s cubic-bezier(.42,.2,.2,.64);
    -o-transition: all 1s cubic-bezier(.42,.2,.2,.64);
    transition: all 1s cubic-bezier(..42,.2,.2,.64);
  }

  .gmesas ul li {
    position: relative;
    float: left;
    width: 140px;
    height: 140px;
    margin: 12px;
    padding: 5px;
    list-style-type: none;
  }

  .gmesas ul li:hover {
    z-index: 99;
  }

  .gmesas ul li img {
    position: absolute;
    left: 0;
    top: 0;
    border: 1px solid #999999;
    padding: 5px;
    width: 140px;
    height: 140px;
    background: #abc4d6;
    -webkit-box-shadow: -4px 47px 40px 6px rgba(0,0,0,0.75);
    -moz-box-shadow: -4px 47px 40px 6px rgba(0,0,0,0.75);
    box-shadow: inset 9px 9px 40px 6px rgba(0,0,0,0.75);
    border-radius: 75px;
  }

@media screen and (min-width: 400px) and (max-width: 513px){
.gmesas ul li {
    position: relative;
    float: left;
    width: 113px;
    height: 93px;
    margin: 12px;
    padding: 5px;
    list-style-type: none;
    margin-left: 21px;
}
    .gmesas ul li, .gmesas li img {
        -webkit-transition: all 1s cubic-bezier(.42,.2,.2,.64);
        -moz-transition: all 1s cubic-bezier(.42,.2,.2,.64);
        -o-transition: all 1s cubic-bezier(.42,.2,.2,.64);
        transition: all 1s cubic-bezier(..42,.2,.2,.64);
    }
    .gmesas ul li img {
    position: absolute;
    left: 0;
    top: 0;
    border: 1px solid #999999;
    padding: 5px;
    width: 90px;
    height: 90px;
    background: #abc4d6;
    -webkit-box-shadow: -4px 47px 40px 6px rgba(0,0,0,0.75);
    -moz-box-shadow: -4px 47px 40px 6px rgba(0,0,0,0.75);
    box-shadow: inset 9px 9px 40px 6px rgba(0,0,0,0.75);
    border-radius: 75px;
}
#pentagon {
    position: relative !important;
    margin: 0rem -23px !important;
    margin-top: 61px !important;
    width: 126px !important;
    border-width: 34px 29px 0px !important;
    border-style: solid !important;
    border-color: #cecab2 transparent !important;
}
.nombresilla {
    font-size: 13px !important; ;
    line-height: 0px !important;  ;
    font-weight: 600 !important;  ;
    font-style: italic !important;  ;
        margin-top: -29px !important;
    margin-left: 12px !important;
    color: #2d638a !important;  ;
}
.ng-binding {
    font-size: 12px !important; ;
    line-height: 0px !important;  ;
    font-weight: 600;
    font-style: italic !important;  ;
    margin-left: 9px !important;
    color: #2d638a !important;  ;
}
  }

@media screen and (max-width: 399px) {
.gmesas ul li {
    position: relative;
    float: left;
    width: 113px;
    height: 93px;
    margin: 12px;
    padding: 5px;
    list-style-type: none;
    margin-left: 0px;
}
    .gmesas ul li, .gmesas li img {
        -webkit-transition: all 1s cubic-bezier(.42,.2,.2,.64);
        -moz-transition: all 1s cubic-bezier(.42,.2,.2,.64);
        -o-transition: all 1s cubic-bezier(.42,.2,.2,.64);
        transition: all 1s cubic-bezier(..42,.2,.2,.64);
    }
    .gmesas ul li img {
    position: absolute;
    left: 0;
    top: 0;
    border: 1px solid #999999;
    padding: 5px;
    width: 90px;
    height: 90px;
    background: #abc4d6;
    -webkit-box-shadow: -4px 47px 40px 6px rgba(0,0,0,0.75);
    -moz-box-shadow: -4px 47px 40px 6px rgba(0,0,0,0.75);
    box-shadow: inset 9px 9px 40px 6px rgba(0,0,0,0.75);
    border-radius: 75px;
}
#pentagon {
    position: relative !important;
    margin: 0rem -23px !important;
    margin-top: 61px !important;
    width: 126px !important;
    border-width: 34px 29px 0px !important;
    border-style: solid !important;
    border-color: #cecab2 transparent !important;
}
.nombresilla {
    font-size: 13px !important; ;
    line-height: 0px !important;  ;
    font-weight: 600 !important;  ;
    font-style: italic !important;  ;
        margin-top: -29px !important;
    margin-left: 12px !important;
    color: #2d638a !important;  ;
}
.ng-binding {
    font-size: 12px !important; ;
    line-height: 0px !important;  ;
    font-weight: 600;
    font-style: italic !important;  ;
    margin-left: 9px !important;
    color: #2d638a !important;  ;
}

}
/* .gmesas ul li img:hover {
  width: 140px;
  height: 140px;
  margin-top: -120px;
  margin-left: -120px;
  top: 50%;
  left: 50%;
  /*filter: grayscale(0%);
  /*-webkit-filter: grayscale(0%);
  /*-moz-filter: grayscale(0%);
  /*-ms-filter: grayscale(0%);
  /*-o-filter: grayscale(0%);
  border-radius: 40px;
  } */

  hr {
    height: 1px;
    background-color: black;
    margin: 10rem auto;
  }
  .nombresilla{
    font-size: 20px;
    line-height: 0px;
    font-weight: 600;
    font-style: italic;
    /*margin-top: -39px; */
    color: #2d638a;
  }
  .ng-binding{
    font-size: 16px;
    line-height: 0px;
    font-weight: 600;
    font-style: italic; 
    /*margin-left: 5px; */
    color: #2d638a;
  }
  #pentagon {
    position: relative;
    margin: 7rem auto;
    width: 126px;
    border-width: 50px 14px 0;
    border-style: solid;
    border-color: #cecab2 transparent;
  }
</style> 
<div class="seccion">
  <div class="row">        
    <div class="col-md-4 col-12">
      <select name="select" onchange="salones(this.value)" class="form-control input-lg">
        <option  value="">Todo los Salones</option>
        <?php foreach ($data["salones"] as $key => $value) { ?>
          <option value="<?php echo $value["lugarmesa_id"]; ?>"><?php echo $value["lugarmesa_descripcion"] ?></option>
        <?php } ?>
      </select>
    </div>
    <div class="col-md-4 col-12">
      <select name="select" id="estados" onchange="buscar(this.value)" class="form-control input-lg">
        <option value="">Todos</option>
        <option value="0" id="estados0" >Libres</option>
        <?php if ($_COOKIE["id_perfil"] == 5 || $_COOKIE["id_perfil"] == 8 || $_COOKIE["id_perfil"] == 12) { ?>
          <option value="1" >Ocupados</option>
        <?php } else{ ?>
          <option value="1">Mis Pedidos</option>
          <?php if ($data["configuracion"][0] == 1){ ?> 
            <option value="3">Mis Sectores</option>
          <?php } ?>      
        <?php } ?>
        <option value="2">Reservados</option>
      </select>
    </div>
    <div class="col-md-4 col-12">        
      <input type="text" name="buscar_mesas" id="buscar_mesas" class="form-control" placeholder="Buscar mesas">
    </div>


<!--
    <div class="row">
    <button class="buttton">hola</button>
    </div>
-->
  </div> 
</div>
<div class="seccion">
  <!-- <div class="gmesas" id="valoresmesa" onclick ="dejar_mostrar()">-->
    <div class="gmesas" id="valoresmesa" >
  </div>
</div>









<style type="text/css">
    .center_{
    position: absolute;
    top: 50%;
    left: 50%;
    margin-bottom: 10px;
    transform: translate(-50%, -50%);
}

</style>





<!-- Modal -->
<div class="modal fade" id="modal_agrupar_mesa" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <form id="formulario_agrupar_mesa"  name="formulario_agrupar_mesa">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Agrupar mesa</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
         <input type="hidden" id="idsilla" value="" name="idsilla">
          <div class="row" id="cargar_mesas_agrupar" >
        
    
           



          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="button" onclick="enviar_unir_mesa()"  id="btn_agrupar_mesa" class="btn btn-primary">Guardar</button>
      </div>

  </form>
    </div>
  </div>
</div>






<style type="text/css">
  .custom-menu { 
    z-index:1000; 
    position: absolute; 
    background-color:white; 
    border: 1px solid black; 
    padding: 2px; 
    width: 100px;
    cursor: pointer;
    color: black;
    text-align: center;
} 
</style>
<script>

function anularagrupacion(idsilla){



      $.post(base_url+"Venta_mesa/anular_mesaagrupar",{"idsilla":idsilla},function(resp){


        if(resp["estado"])
        {

            alertasuccess("EXCELENTE",resp["mensaje"]);

        }else{
            alertainfo("ERROR",resp["mensaje"]);

        }
      },"json");













}


function enviar_unir_mesa()
{
  let c=0;

      $("input[name='mesanueva[]']").map(function() {

// alert();
      if($(this).prop('checked'))
      {
        c++;
      }
  });

     // alert(c);
      if(c==0)
      {
     alert("tiene ingresar al menos una mesa");
      }

$("#btn_agrupar_mesa").text("Guardando...");
$("#btn_agrupar_mesa").attr("disabled",true);

      $.post(base_url+"Venta_mesa/guardar_mesa_agrupar",$("#formulario_agrupar_mesa").serialize(),function(resp){
 $("#modal_agrupar_mesa").modal('hide');

$("#btn_agrupar_mesa").text("Guardar");
$("#btn_agrupar_mesa").attr("disabled",false);
        if(resp["estado"])
        {

            alertasuccess("EXCELENTE",resp["mensaje"]);

        }else{
            alertainfo("ERROR",resp["mensaje"]);

        }
      },"json");

    //return false;
}

function agrupar(idsilla,opcion,nombremesas)
{
  $("#cargar_mesas_agrupar").empty().html('<center > <h1 class="center_"><i class="fa fa-spin fa-spinner"></i></h1> </center>');
  url = base_url+"Venta_mesa/buscar_mesas_agrupar";
 // alert(idsilla);
 $("#modal_agrupar_mesa").modal();
 $("#idsilla").val(idsilla);
   $.post(url,{"idsilla" : idsilla}, function(data){
             var html="";
             for (var i = 0; i < data.length; i++) {
                         html+='<div class="col-md-12" style="margin-top:2px;margin-bottom:2px;">';
                        html+='<div class="form-check">';
                         html+='<input required="true" class="form-check-input" type="checkbox" name="mesanueva[]" id="mesanueva'+data[i]["mesa_id"]+'" value="'+data[i]["mesa_id"]+'">';
                    html+='<label class="form-check-label" for="mesanueva'+data[i]["mesa_id"]+'">';
                html+=data[i]["nombre_silla"]+"("+data[i]["lugarmesa_descripcion"]+")";
                      html+='</label>';
                  html+='</div>';
               html+='</div>';
             }


             $("#cargar_mesas_agrupar").empty().append(html);
                  //  generar_notificaciontoastrop('Se cancelo correctamente','La reserva fue cancelado correctamente','success'); 
                   // reload_url('Venta_mesa/llamarlista');
                },'json');

}













var pressTimer;


$(".buttton").on("mouseup touchstart", function () {
    //alert();
    clearTimeout(pressTimer)
    // Clear timeout
    return false;
}).on("mousedown touchstart", function () {
    // Set timeout
    pressTimer = window.setTimeout(function () {
        alert("hi");
    }, 500)
    return false;
});















  function cargar_menu(e,id)
  {
   // alert();
   if(id!=null){

 $("div.custom-menu").hide(); 
   $("<div class='custom-menu' ><a  target='_blank' href='"+base_url+"Precuenta/mostrar_comprobante/"+id+"'>Cuenta</a></div>").appendTo("body").css({top: event.pageY + "px", left: event.pageX + "px"}); 

   }
  
  }
  function cargar_precuenta(id)
  {
   
  }
  //$(document).bind("contextmenu", function(e){ 
 // //  return false;
 // });

 window.oncontextmenu = function (e) {
//  alert();
  e.preventDefault()
///$("<div class='custom-menu'>Custom menu</div>") 
    // .appendTo("body") 
     //.css({top: event.pageY + "px", left: event.pageX + "px"}); 
}

$(document).bind("click", function(event) { 
    $("div.custom-menu").hide(); 
}); 
  $(function () { 
    
    //validarcaja(); 
  });  
</script>
<script type="text/javascript">
  //function dejar_mostrar()  {
  //  $("#menuCapa").hide('fast'); 
  //}
  //var id_venta_prefactura=0;
  //function generar_prefactura(){
   // $.post(base_url+"Venta_mesa/crear_prefactura",{"id_venta":id_venta_prefactura},function(data)
   // {
//
   // });
   // $("#menuCapa").hide('fast'); 
 // }
  var valor="" ;
  var idsalon;
  var idestado;
  setime =  setInterval(function(){  
    llamarbusqueda(valor); 
  }, 1000);

 function realizarventa(idventa,idvendedor,idmesa,idsilla,sillaestado,nombremesas){

    if (sillaestado == 0) {
        $.confirm({
            title: 'Qué desea hacer?',
            content: 'Por favor seleccione una opción!',
            buttons: {
                pedido: {
                    text: 'pedido',
                    btnClass: 'btn-success',
                    keys: ['enter', 'shift'],
                    action: function(){
                        llamarfuncion(idsilla,1,nombremesas);
                    }
                },

                 agrupar: {
                    text: 'agrupar',
                    btnClass: 'btn-primary',
                    action: function(){
                       agrupar(idsilla,2,nombremesas);
                   }
               },
              reserva: {
                    text: 'reserva',
                    btnClass: 'btn-warning',
                    action: function(){
                       llamarfuncion(idsilla,2,nombremesas);
                   }
               },
               cancelar: {
                text: 'cancelar',
                btnClass: 'btn-red',
                action: function(){

                }
            }
        }
    });

    }

    else if(sillaestado == 4){

         $.confirm({
            title: 'Qué desea hacer?',
            content: 'Por favor seleccione una opción!',
            buttons: {
                pedido: {
                    text: 'Pedido',
                    btnClass: 'btn-success',
                    keys: ['enter', 'shift'],
                    action: function(){
                        llamarfuncion(idsilla,1,nombremesas);
                    }
                },
                reserva: {
                    text: 'Anular Agrupacion',
                    btnClass: 'btn-warning',
                    action: function(){
                       anularagrupacion(idsilla);
                   }
               },
               cancelar: {
                text: 'Cancel',
                btnClass: 'btn-red',
                action: function(){

                }
            }
        }
    });

    }
    else{
        $.confirm({
            title: 'Qué desea hacer?',
            content: 'Por favor seleccione una opción!',
            buttons: {
                pedido: {
                    text: 'Pedido',
                    btnClass: 'btn-success',
                    keys: ['enter', 'shift'],
                    action: function(){
                        llamarfuncion(idsilla,1,nombremesas);
                    }
                },
                reserva: {
                    text: 'Anular Reserva',
                    btnClass: 'btn-warning',
                    action: function(){
                       anularpedido(idsilla);
                   }
               },
               cancelar: {
                text: 'Cancel',
                btnClass: 'btn-red',
                action: function(){

                }
            }
        }
    });

    }

}





function llamarfuncion(idsilla,opcion,nombremesas){
    $("#editarmesa").modal('hide');
    if(opcion == 1){
        setTimeout(function(){
            clearTimeout(setime); 
            reload_urlp('Ventas/nuevaventa/'+idsilla+'/'+opcion+'/'+nombremesas);
        },1000);
                    //window.location.href =base_url+"Ventas/nuevo?idsilla="+idsilla;

                }else{
                    url = base_url+"Venta_mesa/reserva";
                    $.post(url,{"idsilla" : idsilla,"opcion" : opcion}, function(data){
 
                        generar_notificaciontoastrop('Se registro correctamente','La reserva se realizó correctamente','success'); 
                       // reload_url('Venta_mesa/llamarlista');
                    //location.reload();
                },'json');

                }
            }

            function anularpedido(idsilla){
                url = base_url+"Venta_mesa/anularpedido";
                $.post(url,{"idsilla" : idsilla}, function(data){
                    generar_notificaciontoastrop('Se cancelo correctamente','La reserva fue cancelado correctamente','success'); 
                   // reload_url('Venta_mesa/llamarlista');
                },'json');
            }

            function cargarventa(idventa,idvendedor,idsilla,opcion,nombremesas){
                $("#editarmesa").modal('hide');
                if(opcion == 1){
                    url = base_url+"Venta_mesa/validarmozo";
                    $.post(url,{"idsilla" : idsilla,"idventa" : idventa,"idvendedor" : idvendedor}, function(data){
                        if (data["band"] == 0) {
                           setTimeout(function(){
                            clearTimeout(setime);
                            reload_urlp('Ventas/traerventas/'+idventa+'/'+idvendedor+'/'+idsilla+'/'+nombremesas);
                        },1000);
                       }else{
                        $.confirm({
                            icon: 'fa fa-spinner fa-spin',
                            title: 'Lo sentimos!',
                            content: 'Esta atención debe ser efectúada por :  '+data["data"][0]["empleado_nombres"].toUpperCase() +' '+data["data"][0]["empleado_apellidos"].toUpperCase(),
                            buttons: {

                             cancelar: {
                                text: 'Ok',
                                btnClass: 'btn-red',
                                action: function(){

                                }
                            }
                        }
                    });
                    }
                },'json');
                    return 0;

                }else{
                    url = base_url+"Adminmesa/reserva";
                    $.post(url,{"idsilla" : idsilla,"opcion" : opcion}, function(data){
                        generar_notificaciontoastrop('Se registro correctamente','La reserva se realizó correctamente','success'); 
                        reload_url('Adminmesa/cargar');
                    },'json');

                }
            }

            $("#buscar_mesas").keyup(function(e){
              event.preventDefault();
              num = event.keyCode;

              if(num!=86){
                 valor=$(this).val();


                 $("#cargar").removeClass("zmdi-search");
                 $("#cargar").addClass("zmdi-refresh-sync");
                 llamarbusqueda(valor);
             }

         });

            function salones(id){
                valor = $("#buscar_mesas").val();
                if(id != ''){
                 idsalon=id;
                 $("#botonarea").text(($("#areas"+id).text()));  
             }else{
                idsalon=undefined;
                $("#botonarea").text(($("#areas").text()));
            }

            llamarbusqueda(valor);
        }
        function buscar(id){
 

            valor = $("#buscar_mesas").val();
            if(id != ''){
                idestado=id;
                $("#btonbuscar").text(($("#estados"+id).text()));  
            }else{
                idestado=undefined;
                $("#btonbuscar").text(($("#estados").text()));
            }
            llamarbusqueda(valor);
        }
        function llamarbusqueda(valor){
         $.post(base_url+"Venta_mesa/llamarventanalista",{"valor":valor,"idsalon":idsalon,"idestado":idestado},function(data){
            if (data["cont"]==1) {
                band = 0;
                $("#cargar").addClass("zmdi-search");
                $("#cargar").removeClass("zmdi-refresh-sync");
                $("#valoresmesa").empty().html(data["html"]);
                //llamarinicio();
            }else{
                if (band == 0) {
                    band++;   
                    $("#valoresmesa").empty().html(data["html"]);
                }else{
                    band++;   
                }
            }
        },"json");
     }
     function mostrar_modal_preventa(e,e1){

     }
</script>


